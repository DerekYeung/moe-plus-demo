!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EwsBridgeCompiler=t()}(this,function(){"use strict";function e(t,s){var i;s=s||{bubbles:!1,cancelable:!1,detail:void 0};try{(i=document.createEvent("CustomEvent")).initCustomEvent(t,s.bubbles,s.cancelable,s.detail)}catch(e){for(var n in i=document.createEvent("Event"),s)i[n]=s[n];i.initEvent(t,s.bubbles,s.cancelable)}return i}void 0!==window.CustomEvent&&(e.prototype=window.CustomEvent.prototype);function t(){var r=this;this.runtime=null,this.awaits=[],this.scaned=0,this.scan(),this.processers={},window.plus?this.plusReady():document.addEventListener("plusready",this.plusReady(),!1),window.addEventListener("ews-bridge-callback",function(e){var t=e.detail,s=t.uuid,i=r.processers[s];if(!i)return!1;if(t.success)i.emit("success",t.data),i.emit("promise-resolve",t.data);else{var n=t.error?t.error:t.data;i.emit("error",n),i.emit("promise-reject",n)}delete r.processers[s]})}t.prototype.plusReady=function(){this.runtime=window.plus;for(var e=0;e<this.awaits.length;e++){var t=this.awaits[e];t.sdk.ready.apply(t.sdk,[this,t.successCallback]),this.awaits.splice(e,1)}this.webview=this.runtime.webview.currentWebview()},t.prototype.wait=function(e,t){this.awaits.push({sdk:e,successCallback:t})},t.prototype.exec=function(e,t,s,i){void 0===t&&(t={});var n=e+"@"+Math.random().toString(36).substr(2),r=JSON.stringify({cmd:e,uuid:n,args:t}),o={uuid:n,events:{},on:function(e,t){return t&&(this.events[e]=t),this},emit:function(e){for(var t=[],s=arguments.length-1;0<s--;)t[s]=arguments[s+1];var i=this.events[e];return i&&i.apply(this,[].concat(t)),this}},a=null!=typeof Promise?new Promise(function(t,s){o.on("promise-resolve",function(e){t(e)}),o.on("promise-reject",function(e){s(e)})}):null;o.on("success",function(e){s&&s(e)}),o.on("error",function(e){i&&i(e)}),this.processers[n]=o;var u="window.dispatchEvent(new window.CustomEvent('ews-bridge-message', { detail: "+r+", bubbles: true, cancelable: true }))";return this.webview.parent().evalJS(u),a},t.prototype.scan=function(){var t=this;if(1e3<=this.scaned)return!1;setTimeout(function(){t.scaned++;var e=window.EwseduSdk;e?e.arrive(self):t.scan()},10)},window.CustomEvent=e;var s=t;window.EwsBridge=new s;return{}});