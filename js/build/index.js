webpackJsonp([1],{541:function(e,t,a){"use strict";var n,r=a(223),o=(n=r)&&n.__esModule?n:{default:n};var i=a(64),s=a(99).default,c=new i;c.on("plusReady",function(){s(c.Runtime);var e=c.Runtime,t=e.engine,a=t.webview.getLaunchWebview(),n=e.Page.current,r=e.Push,i="android"==e.Client.os.name.toLowerCase(),d={pause:!1,events:{click:function(t){if(t.path){var a=t.path;0===a.indexOf("#")&&e.Page.invoke(a.replace("#",""),t.query||{})}},receive:function(a){a.text&&a.transmission&&(t.push.createMessage(a.text,a),t.device.vibrate());var n=e.App.getBadgeNumber();e.App.setBadgeNumber(n+1)}},init:function(){var t=this;r.addEventListener("click",function(a){if(a.payload=a.aps?a.payload.data:a.payload,"string"==typeof a.payload)try{a.payload=JSON.parse(a.payload)}catch(e){a.payload={}}if(a.payload.data=a.payload.data||{},"string"==typeof a.payload.data)try{a.payload.data=JSON.parse(a.payload.data)}catch(e){a.payload.data={}}t.events.click(a.payload),e.Page.emit("push/click",a)},!1),r.addEventListener("receive",function(a){try{if("string"==typeof a.payload)try{a.payload=JSON.parse(a.payload)}catch(e){a.payload={}}if(a.payload.data=a.payload.data||{},"string"==typeof a.payload.data)try{a.payload.data=JSON.parse(a.payload.data)}catch(e){a.payload.data={}}t.events.receive(a.payload),e.Page.emit("push/receive",a)}catch(e){console.error(e.message)}},!1),document.addEventListener("pause",function(){t.pause=!0},!1),document.addEventListener("resume",function(){t.pause=!1,e.Safety.securityCheck()},!1)}},u={loadingTip:document.querySelector("#loading-tip"),tip:document.querySelector("#tip")||{},start:function(){var n=this;e.Permission.init(),e.Updater.use(a),this.loadingTip&&this.loadingTip.classList.remove("hide"),window.addEventListener("home-loaded",function(t){n.tip.innerHTML="",e.Passport.showHome()}),window.addEventListener("download-app",function(e){var t=document.querySelector("#downloading"),a=document.querySelector("#download-percent");t&&t.classList.remove("hide"),a&&(a.innerHTML=e.detail+"%")}),window.addEventListener("install-app",function(e){n.tip.innerHTML="正在更新应用"}),window.addEventListener("restart-app",function(t){e.App.restart()});var r=function(a){var n=t.webview.getTopWebview(),r=n.isInvoke||!1;return n.canBack(function(a){a.canBack?window.history.back():n.id==t.runtime.appid?i&&t.android.runtimeMainActivity().moveTaskToBack(!0):r?e.Page.close("auto",n):e.Page.back(!1,"auto",n)}),!1};return t.key.addEventListener("backbutton",r,!1),t.key.addEventListener("menubutton",r,!1),this.check()},restart:function(){e.App.restart()},check:function(){var t=this;return this.checkAppVersion().then(function(t){if(t==e.Updater.status.failed){var a=new Error("需要更新版本");return a.name="update",o.default.reject(a)}return 1}).then(function(){return t.tip.innerHTML="",t.getLoginState()}).then(function(t){return e.Passport.loadHome(a)}).then(function(){return o.default.resolve(d.init())}).then(function(){return o.default.resolve(e.IO.init())}).then(function(){return t.checkArguments()}).catch(function(e){t.showError(e)})},checkAppVersion:function(){return o.default.resolve(1)},checkWelcome:function(){var t=e.Session.get("welcome/show");return t||new o.default(function(t){var a=e.Page.pop("/common/welcome/index");a?a.onclose=function(){t()}:t()})},checkArguments:function(){var e=t.runtime.arguments;if(e){var a="";try{a=JSON.parse(e)}catch(e){a={}}d.events.click(a)}},getLoginState:function(){return e.User.isLogined()?e.User.userid:0},parseError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"string"==typeof e?e:(e.engine&&(e.isNetworkError=!0,0===e.status&&(e.noNetworkError=!0)),e)},showUpdate:function(){var t=e.Page.exists("/common/update/index");t&&t.close(""),(t=e.Page.create("/common/update/index",null,{},{param:{data:e.Updater.data}})).onclose=function(){u.restart()},t.hide(),n.append(t),t.show("fade-in")},showError:function(t){if(t=t||{},"update"==(t=this.parseError(t)).name)return this.showUpdate(),!1;var a=t,r="";t instanceof Error&&(a=t.message,a+=t.stack);var o=e.Page.exists("/common/status/error");o&&o.close("none"),t.noNetworkError&&(a="无法访问网络",r="请检查网络以及网络访问权限后重试"),(o=e.Page.create("/common/status/error",null,{},{param:{message:a,tip:r,showRetry:!0}})).onclose=function(){u.restart()},o.hide(),n.append(o),o.show("fade-in")}};u.start()})}},[541]);